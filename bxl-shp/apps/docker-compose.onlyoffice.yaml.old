services: 
  onlyoffice-office:
    container_name: onlyoffice-office
    image: onlyoffice/documentserver:latest
    restart: unless-stopped
    environment:
    - TZ=Europe/Paris
    - DB_TYPE=postgres
    - DB_HOST=postgres
    - DB_NAME=onlyoffice
    - DB_USER=postgres
    - DB_PWD=${POSTGRES_PASSWORD}
    - REDIS_SERVER_HOST=redis
    volumes:
    - $DATA/onlyoffice/document-log:/var/log/onlyoffice
    - $DATA/onlyoffice/document-data:/var/www/onlyoffice/Data
    networks:
    - storage

  onlyoffice-community:
    container_name: onlyoffice-community
    image: onlyoffice/communityserver:latest
    #restart: none #unless-stopped
    environment:
    - TZ=Europe/Paris
    - DB_TYPE=postgres
    - DB_HOST=postgres
    - DB_NAME=onlyoffice-community
    - DB_USER=postgres
    - DB_PWD=${POSTGRES_PASSWORD}
    - REDIS_SERVER_HOST=redis
    - DOCUMENT_SERVER_PORT_80_TCP_ADDR=onlyoffice-office
    privileged: true
    volumes:
    - $DATA/onlyoffice/community-log:/var/log/onlyoffice
    - $DATA/onlyoffice/community-data:/var/www/onlyoffice/Data
    #- /sys/fs/cgroup:/sys/fs/cgroup:rw 
    labels:
    - "traefik.enable=true"
    - "traefik.http.routers.onlyoffice.rule=Host(`onlyoffice.bhasher.com`)"
    - "traefik.http.services.onlyoffice.loadbalancer.server.port=80"
    - "traefik.http.routers.onlyoffice.tls=true"
    - "traefik.http.routers.onlyoffice.tls.certresolver=http"
    - "traefik.http.routers.onlyoffice.entrypoints=internalsecure"
    networks:
    - external
    - storage

networks:
  external:
    external: true
  storage:
    external: true
